<% content_for :head do %>
  <style>
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .grid-lines {
      background-image: linear-gradient(to bottom, #e7edf3 1px, transparent 1px);
      background-size: 100% 60px;
    }
    .dark .grid-lines {
      background-image: linear-gradient(to bottom, #2d3748 1px, transparent 1px);
    }
  </style>
<% end %>

<% week_start = Date.current.beginning_of_week(:monday) %>
<% week_days = (0..6).map { |i| week_start + i } %>
<% today = Date.current %>
<% time_slots = (8..20).to_a %>
<% events = [
  { day: 0, title: "Weekly Team Sync", start: 9, duration: 1, color: "blue", location: "Room 402" },
  { day: 1, title: "Dentist Appointment", start: 11, duration: 1, color: "orange", location: nil },
  { day: 2, title: "Client Call", start: 13, duration: 1, color: "emerald", location: "Zoom" },
  { day: 2, title: "Product Review", start: 15, duration: 1.5, color: "purple", location: "Board Room" },
  { day: 4, title: "Deep Work", start: 10, duration: 2, color: "slate", location: nil }
] %>

<div class="flex flex-col min-h-[calc(100vh-6rem)] overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark shadow-sm">
  <header class="flex flex-wrap items-center justify-between gap-4 border-b border-gray-200 dark:border-gray-800 px-6 py-4">
    <div class="flex items-center gap-3">
      <div class="size-9 rounded-lg bg-primary/10 text-primary flex items-center justify-center">
        <span class="material-symbols-outlined text-xl">calendar_month</span>
      </div>
      <div>
        <h1 class="text-lg font-bold text-slate-900 dark:text-white">Week Plan</h1>
        <p class="text-xs text-slate-500"><%= @lead.full_name.presence || @lead.username %></p>
      </div>
    </div>
    <div class="hidden md:flex items-center gap-3 rounded-xl bg-background-light dark:bg-background-dark px-2 py-1">
      <button class="p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
        <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chevron_left</span>
      </button>
      <span class="text-sm font-semibold px-2 min-w-[160px] text-center">
        <%= week_start.strftime("%b %d") %> - <%= (week_start + 6).strftime("%b %d") %>
      </span>
      <button class="p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
        <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">chevron_right</span>
      </button>
    </div>
    <div class="flex items-center gap-3">
      <button class="hidden sm:inline-flex items-center gap-2 rounded-xl h-10 px-4 bg-primary text-white text-sm font-semibold hover:bg-blue-600">
        <span class="material-symbols-outlined text-[18px]">add</span>
        Nuovo evento
      </button>
      <button class="flex size-10 items-center justify-center rounded-xl bg-gray-100 dark:bg-gray-800 text-slate-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700">
        <span class="material-symbols-outlined">settings</span>
      </button>
    </div>
  </header>

  <div class="flex flex-1 overflow-hidden">
    <aside class="hidden xl:flex w-72 flex-col border-r border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-4 gap-6 overflow-y-auto">
      <div class="rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800/50 p-4 shadow-sm">
        <div class="flex items-center justify-between mb-4">
          <span class="text-sm font-bold"><%= week_start.strftime("%B %Y") %></span>
          <div class="flex gap-1">
            <button class="size-6 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
              <span class="material-symbols-outlined text-sm">chevron_left</span>
            </button>
            <button class="size-6 flex items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
              <span class="material-symbols-outlined text-sm">chevron_right</span>
            </button>
          </div>
        </div>
        <div class="grid grid-cols-7 text-center text-xs mb-2 text-gray-400">
          <span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span><span>S</span>
        </div>
        <div class="grid grid-cols-7 gap-y-2 text-center text-sm">
          <% week_days.each do |day| %>
            <% if day == today %>
              <span class="mx-auto flex size-7 items-center justify-center rounded-full bg-primary text-white font-semibold"><%= day.day %></span>
            <% else %>
              <span class="<%= day.month == week_start.month ? "text-slate-700 dark:text-slate-200" : "text-gray-300 dark:text-gray-600" %>"><%= day.day %></span>
            <% end %>
          <% end %>
        </div>
      </div>
      <div>
        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 px-1">Highlights</h3>
        <div class="space-y-3">
          <div class="flex items-start gap-3">
            <div class="size-2 rounded-full bg-blue-500 mt-1.5 shrink-0"></div>
            <div>
              <p class="text-sm font-semibold text-slate-900 dark:text-white">Weekly Team Sync</p>
              <p class="text-xs text-gray-500">Mon 09:00 - 10:00</p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <div class="size-2 rounded-full bg-purple-500 mt-1.5 shrink-0"></div>
            <div>
              <p class="text-sm font-semibold text-slate-900 dark:text-white">Product Review</p>
              <p class="text-xs text-gray-500">Wed 15:00 - 16:30</p>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <main class="flex-1 flex flex-col bg-white dark:bg-surface-dark overflow-hidden">
      <div class="flex border-b border-gray-200 dark:border-gray-800">
        <div class="w-16 border-r border-gray-100 dark:border-gray-800 shrink-0"></div>
        <div class="flex-1 grid grid-cols-7 divide-x divide-gray-100 dark:divide-gray-800">
          <% week_days.each do |day| %>
            <div class="py-3 text-center <%= day == today ? "bg-blue-50/30 dark:bg-blue-900/10" : "" %>">
              <span class="block text-xs font-medium text-gray-500 uppercase"><%= day.strftime("%a") %></span>
              <div class="mt-1 flex justify-center">
                <span class="flex size-8 items-center justify-center rounded-full text-lg font-medium <%= day == today ? "bg-primary text-white shadow-md" : "text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800" %>">
                  <%= day.day %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
        <div class="w-4 shrink-0"></div>
      </div>

      <div class="flex-1 overflow-y-auto relative no-scrollbar">
        <div class="flex min-h-[780px]">
          <div class="w-16 flex flex-col items-center shrink-0 border-r border-gray-100 dark:border-gray-800 bg-white dark:bg-surface-dark sticky left-0 z-10 pt-2 select-none">
            <% time_slots.each do |hour| %>
              <div class="h-[60px] text-xs font-medium text-gray-400 -mt-2.5">
                <%= Time.zone.parse("#{hour}:00").strftime("%-I %p") %>
              </div>
            <% end %>
          </div>
          <div class="flex-1 relative grid grid-cols-7 divide-x divide-gray-100 dark:divide-gray-800 grid-lines">
            <% week_days.each_with_index do |day, idx| %>
              <div class="relative group <%= day == today ? "bg-blue-50/10 dark:bg-blue-900/5" : "" %>">
                <% events.select { |e| e[:day] == idx }.each do |event| %>
                  <% top = (event[:start] - 8) * 60 %>
                  <% height = (event[:duration] * 60).to_i %>
                  <div class="absolute left-1 right-2 rounded-lg border-l-4 p-2 shadow-sm bg-<%= event[:color] %>-100 dark:bg-<%= event[:color] %>-900/40 border-<%= event[:color] %>-500 dark:border-<%= event[:color] %>-400"
                       style="top: <%= top %>px; height: <%= height %>px;">
                    <div class="text-xs font-bold text-<%= event[:color] %>-800 dark:text-<%= event[:color] %>-100 truncate">
                      <%= event[:title] %>
                    </div>
                    <% if event[:location].present? %>
                      <div class="text-[10px] text-<%= event[:color] %>-600 dark:text-<%= event[:color] %>-200 mt-0.5 flex items-center gap-1">
                        <span class="material-symbols-outlined text-[10px]">location_on</span>
                        <%= event[:location] %>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
