<%# Blog Creators â€” Index degli articoli dai children del taxbranch %>
<div class="mx-auto max-w-6xl px-4 py-10">
  <header class="mb-8">
    <h1 class="text-3xl font-bold">Blog Creator</h1>
    <% if @taxbranch&.description.present? %>
      <p class="mt-2 text-slate-600"><%= @taxbranch.description %></p>
    <% end %>
  </header>

  <% if @posts.blank? %>
    <p class="text-slate-500">Non ci sono articoli pubblicati.</p>
  <% else %>
    <div class="space-y-6">
      <% current_month = nil %>
      <% @posts.each do |post| %>
        <% post_month = post.published_at&.beginning_of_month %>
        
        <% if post_month != current_month %>
          <% current_month = post_month %>
          <% if current_month.present? %>
            <h2 class="text-2xl font-bold text-slate-800 mt-8 mb-4 pt-4 border-t border-slate-200">
              <%= l(current_month, format: "%B %Y") %>
            </h2>
          <% end %>
        <% end %>

        <article class="border-l-4 border-slate-300 pl-6 py-3 hover:border-slate-500 transition">
  <%# ===== URL stile /YYYY/MM/DD/slug/ (slug casuale se manca) ===== %>
  <% date = (post.published_at || post.created_at || Time.current) %>
  <% yyyy, mm, dd = date.strftime('%Y'), date.strftime('%m'), date.strftime('%d') %>
  <% slug = post.try(:slug).presence || post.title.to_s.parameterize %>
  <% slug = SecureRandom.alphanumeric(8).downcase if slug.blank? %>
  <% url_base = "https://www.markpostura.it" %>
  <% url_path = "/#{yyyy}/#{mm}/#{dd}/#{slug}/" %>
  <% pretty_url = "#{url_base}#{url_path}" %>
  <%# =============================================================== %>

  <%= link_to post, class: "block group" do %>
    <div class="flex flex-col gap-1">
      <span class="text-sm font-medium text-slate-500 group-hover:text-slate-700">
        <%= l(post.published_at, format: :short) %>
      </span>

      <h3 class="text-xl font-semibold text-slate-900 group-hover:text-blue-600 transition">
        <%= post.title %>
      </h3>

      <%# riga URL in stile Filippo Valsorda %>
      <span class="text-sm font-mono text-slate-500 break-all">
        <%= pretty_url %>
      </span>

      <% if post.description.present? %>
        <p class="text-slate-600 group-hover:text-slate-800 transition">
          <%= post.description %>
        </p>
      <% end %>
    </div>
  <% end %>
</article>

      <% end %>
    </div>

    <%# Paginazione %>
    <div class="mt-8">
      <% if @posts.respond_to?(:current_page) %>
        <%= paginate @posts %>
      <% end %>
    </div>
  <% end %>
</div>