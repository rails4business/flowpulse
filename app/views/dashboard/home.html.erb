<% content_for :head do %>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2a8aea",
                        "background-light": "#f6f7f8",
                        "background-dark": "#111921",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .timeline-line::before {
            content: '';
            position: absolute;
            left: 19px;
            top: 40px;
            bottom: 0;
            width: 2px;
            background-color: #e7edf3;
        }
    </style>
<% end %>

<main class="min-h-screen bg-background-light dark:bg-background-dark font-display text-[#0e141b] transition-colors duration-200 flex flex-col">
<% domain_switch_items = @lead_domains.select { |d| d.host.present? } %>
<!-- Top Navigation Bar
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e7edf3] bg-white dark:bg-background-dark dark:border-slate-800 px-10 py-3 sticky top-0 z-50">
<div class="flex items-center gap-4 text-[#0e141b] dark:text-white">
<div class="size-6 text-primary">
<svg fill="currentColor" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M24 45.8096C19.6865 45.8096 15.4698 44.5305 11.8832 42.134C8.29667 39.7376 5.50128 36.3314 3.85056 32.3462C2.19985 28.361 1.76794 23.9758 2.60947 19.7452C3.451 15.5145 5.52816 11.6284 8.57829 8.5783C11.6284 5.52817 15.5145 3.45101 19.7452 2.60948C23.9758 1.76795 28.361 2.19986 32.3462 3.85057C36.3314 5.50129 39.7376 8.29668 42.134 11.8833C44.5305 15.4698 45.8096 19.6865 45.8096 24L24 24L24 45.8096Z"></path>
</svg>
</div>
<h2 class="text-lg font-bold leading-tight tracking-[-0.015em]">posturacorretta.org</h2>
</div>
<div class="flex flex-1 justify-end gap-8">
<nav class="flex items-center gap-9 dark:text-slate-300">
<a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Dashboard</a>
<a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Esercizi</a>
<a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Prodotti</a>
<a class="text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Supporto</a>
</nav>
<div class="flex gap-2">
<button class="flex size-10 items-center justify-center rounded-lg bg-[#e7edf3] dark:bg-slate-800 text-[#0e141b] dark:text-white">
<span class="material-symbols-outlined">notifications</span>
</button>
<button class="flex size-10 items-center justify-center rounded-lg bg-[#e7edf3] dark:bg-slate-800 text-[#0e141b] dark:text-white">
<span class="material-symbols-outlined">person</span>
</button>
</div>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-primary" data-alt="User avatar of Alex" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBIFDCEKbMZ6WhSHW0SSfFw6Y8kjY-_Os94qU1n_pEjKJUREOQCMPeuPS81B7PaIhC6jnRrKbpi9EjIxdv9GD_-6U1oWzOZ_5wJJRte9AdRA5AUSYLRXtpoJRC64kn8GyC41x2O1V0ERiljtQzTLXmKZDiCEZLPRezoI5qwZ8v7gCP5WboOQyIQcbpCWabheYRDfqDkp6xP3R798guOBwbk0HCh5etucUqdcFYtUkmcSiiO4O9GPXTeLnKycOYRTQk3EeQdbjghchg");'></div>
</div>
</header>
-->
<div class="max-w-[1440px] w-full mx-auto grid grid-cols-12 gap-8 px-10 py-8 flex-1">
<!-- Left Section: Persuasive Onboarding -->
<section class="col-span-12 lg:col-span-3 flex flex-col gap-6 bg-white dark:bg-slate-900/50 p-6 rounded-xl border border-[#e7edf3] dark:border-slate-800">
  <% if Current.user&.superadmin? && Current.user&.superadmin_mode_active? %>
    <div>
      <h1 class="text-[#0e141b] dark:text-white tracking-light text-2xl font-bold leading-tight pb-3">Inizia il tuo percorso</h1>
      <p class="text-[#4e6a8d] dark:text-slate-400 text-sm font-normal leading-relaxed">
        Speri di cambiare con l'ennesimo esame? Non ottieni risultati? La tua trasformazione inizia qui.
      </p>
    </div>
    <div class="flex flex-col gap-1">
      <div class="flex items-center gap-x-3 py-2">
        <span class="material-symbols-outlined text-primary text-xl">check_circle</span>
        <p class="text-[#0e141b] dark:text-slate-200 text-sm font-medium">Semplici test</p>
      </div>
      <div class="flex items-center gap-x-3 py-2">
        <span class="material-symbols-outlined text-primary text-xl">map</span>
        <p class="text-[#0e141b] dark:text-slate-200 text-sm font-medium">Linee guida e mappe</p>
      </div>
      <div class="flex items-center gap-x-3 py-2">
        <span class="material-symbols-outlined text-primary text-xl">support_agent</span>
        <p class="text-[#0e141b] dark:text-slate-200 text-sm font-medium">Tutor dedicato</p>
      </div>
      <div class="flex items-center gap-x-3 py-2">
        <span class="material-symbols-outlined text-primary text-xl">groups</span>
        <p class="text-[#0e141b] dark:text-slate-200 text-sm font-medium">Team di professionisti</p>
      </div>
      <div class="flex items-center gap-x-3 py-2">
        <span class="material-symbols-outlined text-primary text-xl">trending_up</span>
        <p class="text-[#0e141b] dark:text-slate-200 text-sm font-medium">Progress tracking</p>
      </div>
    </div>
    <div class="pt-4">
      <button class="w-full flex items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:brightness-110 transition-all">
        <span>Inizia ora: Test mobilità</span>
      </button>
    </div>
  <% else %>
    <div>
      <% if @current_domain.present? %>
        <h3 class="text-lg font-bold text-[#0e141b] dark:text-white">
          <%= @current_domain.title.presence || @current_domain.host %>
        </h3>
        <% if @current_domain.host.present? %>
          <p class="text-sm text-[#4e6a8d] dark:text-slate-400"><%= @current_domain.host %></p>
        <% end %>
      <% end %>

      <% if domain_switch_items.size > 1 %>
        <label for="domain-switch-left" class="mt-2 mb-1 block text-xs text-slate-500">Scegli dominio</label>
        <select id="domain-switch-left"
                class="w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 text-sm"
                onchange="if (this.value) window.location.href = this.value;">
          <% domain_switch_items.each do |domain| %>
            <% target_url = dashboard_home_url(host: domain.host, protocol: request.protocol, port: request.port) %>
            <option value="<%= target_url %>" <%= "selected" if @current_domain&.id == domain.id %>>
              <%= domain.title.presence || domain.host %>
            </option>
          <% end %>
        </select>
      <% elsif @current_domain.blank? %>
        <p class="mt-2 text-sm text-slate-500">Nessun dominio associato.</p>
      <% end %>

      <% if @current_domain.present? %>
        <div class="mt-4 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50/70 dark:bg-slate-900/40 p-3">
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Domain membership</p>
          <% if @domain_membership.present? %>
            <p class="mt-2 text-sm text-slate-700 dark:text-slate-300">
              Ruolo attivo:
              <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-semibold text-primary">
                <%= @domain_membership.domain_active_role.presence || "member" %>
              </span>
            </p>
          <% else %>
            <% domain_name = @current_domain.title.presence || @current_domain.host %>
            <p class="mt-2 text-xs text-slate-500">
              Nessuna membership attiva su <span class="font-semibold"><%= domain_name %></span>.
            </p>
            <%= button_to "Inizia con #{domain_name}",
                          create_dashboard_domain_membership_path,
                          method: :post,
                          class: "mt-2 inline-flex items-center rounded-md bg-primary px-3 py-1.5 text-xs font-semibold text-white hover:brightness-110" %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</section>
<!-- Center Section: Timeline/History -->
<section class="col-span-12 lg:col-span-6 flex flex-col gap-6">
  <div class="flex items-center justify-between px-2">
    <h2 class="text-xl font-bold text-[#0e141b] dark:text-white">Il tuo percorso</h2>
    <div class="flex items-center gap-2 rounded-full bg-white dark:bg-slate-900/40 border border-[#e7edf3] dark:border-slate-800 px-1.5 py-1">
      <%= link_to "Bookings",
                  dashboard_home_path(tab: "bookings"),
                  class: "px-3 py-1 text-xs font-semibold rounded-full #{@tab == 'bookings' ? 'bg-primary text-white' : 'text-slate-500 hover:text-slate-800 dark:text-slate-400'}" %>
      <%= link_to "Enrollments",
                  dashboard_home_path(tab: "enrollments"),
                  class: "px-3 py-1 text-xs font-semibold rounded-full #{@tab == 'enrollments' ? 'bg-primary text-white' : 'text-slate-500 hover:text-slate-800 dark:text-slate-400'}" %>
    </div>
  </div>

  <div class="relative flex flex-col gap-8 timeline-line">
    <% if @tab == "bookings" %>
      <% if @bookings.any? %>
        <% @bookings.each do |booking| %>
          <% ev = booking.eventdate %>
          <div class="relative flex gap-4">
            <div class="z-10 flex size-10 shrink-0 items-center justify-center rounded-full bg-primary text-white">
              <span class="material-symbols-outlined text-sm">event</span>
            </div>
            <div class="flex flex-1 flex-col gap-2 rounded-xl border border-[#e7edf3] dark:border-slate-800 bg-white dark:bg-slate-900/40 p-5 shadow-sm">
              <div class="flex items-start justify-between">
                <div>
                  <span class="text-xs font-semibold text-primary uppercase tracking-wider">
                    <%= ev&.date_start ? I18n.l(ev.date_start, format: "%d %b %Y", locale: :it) : "Senza data" %>
                  </span>
                  <h3 class="text-base font-bold text-[#0e141b] dark:text-white">
                    <%= booking.service&.name || booking.commitment&.role_name || "Booking ##{booking.id}" %>
                  </h3>
                </div>
                <span class="inline-flex items-center gap-1 rounded-full bg-primary/10 px-2.5 py-1 text-xs font-bold text-primary">
                  <%= booking.status.humanize %>
                </span>
              </div>
              <% if ev&.description.present? %>
                <p class="text-sm text-[#4e6a8d] dark:text-slate-400"><%= ev.description %></p>
              <% end %>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="rounded-xl border border-[#e7edf3] dark:border-slate-800 bg-white dark:bg-slate-900/40 p-6 text-sm text-slate-500">
          Nessun booking ancora.
        </div>
      <% end %>
    <% else %>
      <% if @enrollments.any? %>
        <% @enrollments.each do |enrollment| %>
          <div class="relative flex gap-4">
            <div class="z-10 flex size-10 shrink-0 items-center justify-center rounded-full bg-[#e7edf3] dark:bg-slate-800 text-primary">
              <span class="material-symbols-outlined text-sm">check_circle</span>
            </div>
            <div class="flex flex-1 flex-col gap-2 rounded-xl border border-[#e7edf3] dark:border-slate-800 bg-white dark:bg-slate-900/40 p-5 shadow-sm">
              <div class="flex items-start justify-between">
                <div>
                  <span class="text-xs font-semibold text-[#4e6a8d] dark:text-slate-500 uppercase tracking-wider">
                    <%= enrollment.updated_at ? I18n.l(enrollment.updated_at, format: "%d %b %Y", locale: :it) : "—" %>
                  </span>
                  <h3 class="text-base font-bold text-[#0e141b] dark:text-white">
                    <%= enrollment.service&.name || enrollment.journey&.title || "Enrollment ##{enrollment.id}" %>
                  </h3>
                </div>
                <span class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-2.5 py-1 text-xs font-bold text-slate-600">
                  <%= enrollment.status.humanize %>
                </span>
              </div>
              <p class="text-sm text-[#4e6a8d] dark:text-slate-400">
                <%= enrollment.request_kind.humanize %> · <%= enrollment.mode.humanize %>
              </p>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="rounded-xl border border-[#e7edf3] dark:border-slate-800 bg-white dark:bg-slate-900/40 p-6 text-sm text-slate-500">
          Nessun enrollment ancora.
        </div>
      <% end %>
    <% end %>
  </div>
</section>
<!-- Right Section: Profile Widget -->
<aside class="col-span-12 lg:col-span-3 flex flex-col gap-6">
<!-- Next Session Card -->
<div class="bg-primary p-6 rounded-xl text-white shadow-lg shadow-primary/20">
<div class="flex justify-between items-start mb-4">
<p class="text-xs font-bold uppercase tracking-wider opacity-80">CORSO (da spostare in corsi e mettere valutazione articolare)  <!--prossima sessione--></p>
<span class="material-symbols-outlined opacity-80">play_circle</span>
</div>
<h4 class="text-xl font-bold mb-1">60 Movimenti alla scrivania</h4>
<p class="text-sm opacity-90 mb-6">Durata stimata: 15 min</p>
<!--button class="w-full bg-white text-primary h-11 rounded-lg font-bold text-sm hover:bg-slate-50 transition-colors shadow-sm">
                    Continua Sessione
                </button-->
                <a href="https://www.youtube.com/watch?v=Zvm8MhkXuEQ&list=PLpL2gK--L98tP4ujUR79z19QO43cBkv9J" class="inline-flex items-center justify-center w-full h-11 px-4 rounded-lg bg-white text-primary text-sm font-bold hover:bg-slate-50 transition-colors shadow-sm">
                    Inizia
                </a>
</div>
</aside>
</div>
<!-- Simple Footer for branding -->
<footer class="w-full px-10 py-5 flex flex-col items-center border-t border-[#e7edf3] dark:border-slate-800 mt-6">
<p class="text-[#4e6a8d] text-sm">© <%= DateTime.now.year %> posturacorretta.org - La tua salute, la nostra missione.</p>
</footer>
</main>



<%#= render "home_dash_prov" %>
