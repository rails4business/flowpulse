<%= form_with model: [:superadmin, book], class: "space-y-4" do |f| %>
  <% if book.errors.any? %>
    <div class="rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700">
      <p class="font-semibold mb-1">Errori</p>
      <ul class="list-disc ml-5">
        <% book.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid md:grid-cols-2 gap-4">
    <div>
      <%= f.label :title, class: "block text-sm font-medium" %>
      <%= f.text_field :title, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
    <div>
      <%= f.label :slug, class: "block text-sm font-medium" %>
      <%= f.text_field :slug, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
  </div>

  <div>
    <%= f.label :description, class: "block text-sm font-medium" %>
    <%= f.text_area :description, rows: 3, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
  </div>

  <div>
    <%= f.label :cover_image, "Copertina libro", class: "block text-sm font-medium" %>
    <% if book.cover_image.attached? %>
      <div class="mt-2 mb-2">
        <%= image_tag book.cover_image, class: "h-28 w-auto rounded-md border" %>
      </div>
    <% end %>
    <%= f.file_field :cover_image, accept: "image/png,image/jpeg,image/webp", class: "mt-1 block w-full rounded-md border px-3 py-2 bg-white" %>
    <p class="mt-1 text-xs text-slate-500">Formato consigliato: verticale (es. 1200x1800), max 8MB.</p>
  </div>

  <div class="grid md:grid-cols-2 gap-4">
    <div>
      <%= f.label :folder_md, "Cartella markdown", class: "block text-sm font-medium" %>
      <%= f.text_field :folder_md, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
    <div>
      <%= f.label :index_file, "File indice", class: "block text-sm font-medium" %>
      <%= f.text_field :index_file, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
  </div>

  <div class="grid md:grid-cols-3 gap-4">
    <div>
      <%= f.label :price_euro, class: "block text-sm font-medium" %>
      <%= f.number_field :price_euro, step: 0.01, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
    <div>
      <%= f.label :price_dash, class: "block text-sm font-medium" %>
      <%= f.number_field :price_dash, step: 0.00000001, class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
    <div>
      <%= f.label :access_mode, class: "block text-sm font-medium" %>
      <%= f.select :access_mode,
            Book.access_modes.keys.map { |k| [k.humanize, k] },
            {},
            class: "mt-1 block w-full rounded-md border px-3 py-2" %>
    </div>
  </div>

  <div>
    <%= f.label :domain_ids, "Domini", class: "block text-sm font-medium" %>
    <p class="mt-1 text-xs text-slate-500">Seleziona solo i domini su cui il libro deve comparire.</p>
    <div class="mt-2 space-y-2 rounded-md border bg-white p-3 max-h-56 overflow-auto">
      <%= hidden_field_tag "book[domain_ids][]", "" %>
      <% @domains.each do |domain| %>
        <label class="flex items-center gap-2 text-sm">
          <%= check_box_tag "book[domain_ids][]", domain.id, book.domain_ids.include?(domain.id), id: "book_domain_ids_#{domain.id}", class: "h-4 w-4" %>
          <span><%= domain.host %></span>
        </label>
      <% end %>
    </div>
  </div>

  <label class="inline-flex items-center gap-2 text-sm">
    <%= f.check_box :active, class: "h-4 w-4" %>
    Attivo
  </label>

  <div class="flex items-center gap-2">
    <%= f.submit class: "rounded-md bg-blue-600 px-4 py-2 text-white font-semibold" %>
    <%= link_to "Annulla", superadmin_books_path, class: "rounded-md border px-4 py-2" %>
  </div>
<% end %>
