<!-- app/views/taxbranches/_node.html.erb -->
<li
  class="flex items-center justify-between border border-slate-200 rounded-md px-2 py-1.5 bg-white shadow-sm mb-1"
  style="margin-left: <%= node.depth * 12 %>px"  <!-- Indentazione esterna: 12px per livello -->
>
  <!-- Info principale -->
  <div class="flex items-center gap-2 flex-1 min-w-0">
    <!-- (Nessuna indentazione interna: il testo resta vicino al bordo) -->

    <!-- Etichetta -->
    <%= link_to node.slug_label,
                superadmin_taxbranch_path(node),
                class: "text-slate-800 font-medium truncate hover:underline" %>

    <!-- Metadati -->
    <span class="text-xs text-slate-500 truncate">
      (<%= node.slug_category %> / <%= node.slug %>)
    </span>

    <% if node.description.present? %>
      <span class="text-slate-400">‚Äî</span>
      <span class="text-xs text-slate-500 truncate"><%= node.description %></span>
    <% end %>
  </div>

  <!-- Azioni -->
  <% prev = node.higher_item %>
  <% next_node = node.lower_item %>

  <div class="flex items-center gap-2 text-xs text-slate-500 shrink-0">
    <%= link_to "‚ûï", new_superadmin_taxbranch_path(parent_id: node.id),
          class: "hover:text-green-600", title: "Aggiungi figlio" %>
    <%= link_to "‚úèÔ∏è", edit_taxbranch_path(node),
          class: "hover:text-blue-600", title: "Modifica" %>
    <%= link_to "üóëÔ∏è", node,
          data: { turbo_method: :delete, turbo_confirm: "Sicuro?" },
          class: "hover:text-red-600", title: "Elimina" %>

    <span class="text-slate-300">|</span>

    <%# ‚¨Ü Su (solo se non √® il primo) %>
    <% if prev.present? %>
      <%= link_to "‚¨Ü", move_up_taxbranch_path(node),
            data: { turbo_method: :patch },
            method: :patch,
            class: "hover:text-slate-700", title: "Sposta su" %>
    <% else %>
      <span class="opacity-40 cursor-not-allowed" title="Gi√† in cima">‚¨Ü</span>
    <% end %>

    <%# ‚¨á Gi√π (solo se non √® l‚Äôultimo) %>
    <% if next_node.present? %>
      <%= link_to "‚¨á", move_down_taxbranch_path(node),
            data: { turbo_method: :patch },
            method: :patch,
            class: "hover:text-slate-700", title: "Sposta gi√π" %>
    <% else %>
      <span class="opacity-40 cursor-not-allowed" title="Gi√† in fondo">‚¨á</span>
    <% end %>

    <%# ‚¨Ö Outdent %>
    <% if node.parent.present? %>
      <%= link_to "‚¨ÖÔ∏è", move_left_taxbranch_path(node),
            data: { turbo_method: :patch },
            method: :patch,
            class: "hover:text-slate-700", title: "Sposta a sinistra (outdent)" %>
    <% else %>
      <span class="opacity-40 cursor-not-allowed" title="Gi√† a radice">‚¨ÖÔ∏è</span>
    <% end %>

    <%# ‚û° Indent %>
    <% if prev.present? %>
      <%= link_to "‚û°Ô∏è", move_right_taxbranch_path(node),
            data: { turbo_method: :patch },
            method: :patch,
            class: "hover:text-slate-700", title: "Sposta a destra (indent)" %>
    <% else %>
      <span class="opacity-40 cursor-not-allowed" title="Nessun fratello precedente">‚û°Ô∏è</span>
    <% end %>
  </div>
</li>

<% if node.children.exists? %>
  <ul class="ml-0 mt-1 space-y-1">
    <%= render partial: "node", collection: node.children.ordered, as: :node %>
  </ul>
<% end %>
