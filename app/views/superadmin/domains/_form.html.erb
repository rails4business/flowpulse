<%= form_with(model: [:superadmin, domain], class: "contents text-slate-900 dark:text-slate-100") do |form| %>
  <% if domain.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-md mt-3">
      <h2><%= pluralize(domain.errors.count, "error") %> prohibited this domain from being saved:</h2>

      <ul class="list-disc ml-6">
        <% domain.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  

  <div class="my-5">
    <%= form.label :host, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :host, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:host].none?, "border-red-400 focus:outline-red-600": domain.errors[:host].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :language, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :language,
          list: "languages",
          placeholder: "es. it, en, frâ€¦",
          class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700",
                  {"border-gray-400 focus:outline-blue-600": domain.errors[:language].none?,
                  "border-red-400 focus:outline-red-600": domain.errors[:language].any?}] %>

    <datalist id="languages">
      <% %w[it en fr de es pt nl sv no da fi pl cs sk sl hu ro bg el ru tr ar he hi zh ja ko].each do |code| %>
        <option value="<%= code %>"></option>
      <% end %>
    </datalist>
  </div>


  <div class="my-5">
    <%= form.label :title, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :title, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:title].none?, "border-red-400 focus:outline-red-600": domain.errors[:title].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :description, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.textarea :description, rows: 4, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:description].none?, "border-red-400 focus:outline-red-600": domain.errors[:description].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :favicon_url, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :favicon_url, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:favicon_url].none?, "border-red-400 focus:outline-red-600": domain.errors[:favicon_url].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :square_logo_url, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :square_logo_url, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:square_logo_url].none?, "border-red-400 focus:outline-red-600": domain.errors[:square_logo_url].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :horizontal_logo_url, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :horizontal_logo_url, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:horizontal_logo_url].none?, "border-red-400 focus:outline-red-600": domain.errors[:horizontal_logo_url].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :provider, class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_field :provider, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700", {"border-gray-400 focus:outline-blue-600": domain.errors[:provider].none?, "border-red-400 focus:outline-red-600": domain.errors[:provider].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :operative_roles, "Ruoli operativi (uno per riga)", class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    <%= form.text_area :operative_roles,
          value: domain.operative_roles_text,
          rows: 4,
          placeholder: "es.\nIgiene posturale\nConsulenze domiciliari",
          class: [
            "block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700",
            {
              "border-gray-400 focus:outline-blue-600": domain.errors[:operative_roles].none?,
              "border-red-400 focus:outline-red-600": domain.errors[:operative_roles].any?
            }
          ] %>
    <p class="mt-2 text-xs text-slate-500 dark:text-slate-400">
      Inserisci un valore per linea (oppure separali con virgole); i valori vuoti saranno ignorati.
    </p>
  </div>

  <div class="my-5">
    <%= form.label :taxbranch_id, "Taxbranch", class: "text-sm font-medium text-slate-700 dark:text-slate-200" %>
    
    <% if params[:taxbranch_id] %>
      
      <% prefilled_taxbranch = Taxbranch.find_by(id: params[:taxbranch_id]) %>
      <%= form.hidden_field :taxbranch_id, value: params[:taxbranch_id] %>
      <p class="mt-2 text-sm text-slate-700 dark:text-slate-300">
        taxbranch: <strong><%= prefilled_taxbranch&.display_label || "ID #{params[:taxbranch_id]}" %></strong>
      </p>
     <% else %>
        <% selected_taxbranch = @taxbranches.find { |tb| tb.id == domain.taxbranch_id } %>
        <% input_classes = "block shadow-sm rounded-md border px-3 py-2 mt-2 w-full bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 dark:border-slate-700" %>
        <% input_classes = "#{input_classes} #{domain.errors[:taxbranch_id].none? ? 'border-gray-400 focus:outline-blue-600' : 'border-red-400 focus:outline-red-600'}" %>

        <%= hidden_field_tag "domain[taxbranch_id]", domain.taxbranch_id, id: "domain_taxbranch_id_hidden" %>
        <%= text_field_tag :taxbranch_search,
              selected_taxbranch&.slug_label,
              list: "taxbranches-list",
              placeholder: "Cerca taxbranch (autocomplete)",
              id: "taxbranch_search_input",
              class: input_classes %>
        <datalist id="taxbranches-list">
          <% @taxbranches.each do |tb| %>
            <option value="<%= tb.slug_label %>" data-id="<%= tb.id %>"></option>
          <% end %>
        </datalist>
        <p class="mt-2 text-xs text-slate-500 dark:text-slate-400">
          Scrivi il nome e scegli dalla lista suggerita.
        </p>
        <script>
          (() => {
            const input = document.getElementById("taxbranch_search_input");
            const hidden = document.getElementById("domain_taxbranch_id_hidden");
            const list = document.getElementById("taxbranches-list");
            if (!input || !hidden || !list) return;

            const syncHidden = () => {
              const match = Array.from(list.options).find((opt) => opt.value === input.value);
              hidden.value = match ? match.dataset.id : "";
            };

            input.addEventListener("change", syncHidden);
            input.addEventListener("input", syncHidden);
          })();
        </script>
    <% end %>
  </div>
  <div class="inline">
    <%= form.submit class: "w-full sm:w-auto rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" %>
  </div>
<% end %>
