<% content_for :title, "Services" %>
<% content_for :nav do %>
  <%= render "shared/taxbranch_nav", taxbranch: @taxbranch %>
<% end %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl">Services</h1>
    <%= link_to "New service",
                (@taxbranch.present? ? new_superadmin_taxbranch_service_path(@taxbranch) : new_superadmin_service_path),
                class: "rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white block font-medium" %>
  </div>

  <div class="mt-4 border-b border-slate-200">
    <nav class="-mb-px flex flex-wrap gap-3 text-sm">
      <% all_path = @taxbranch.present? ? superadmin_taxbranch_services_path(@taxbranch) : superadmin_services_path %>
      <%= link_to "Tutti", all_path,
                  class: class_names(
                    "px-3 py-2 border-b-2 font-medium",
                    params[:phase].blank? ? "border-slate-900 text-slate-900" : "border-transparent text-slate-500 hover:text-slate-900 hover:border-slate-300"
                  ) %>
      <% Service::PHASES.keys.each do |phase| %>
        <% phase_path = @taxbranch.present? ? superadmin_taxbranch_services_path(@taxbranch, phase: phase) : superadmin_services_path(phase: phase) %>
        <%= link_to phase.to_s.humanize, phase_path,
                    class: class_names(
                      "px-3 py-2 border-b-2 font-medium",
                      params[:phase].to_s == phase.to_s ? "border-slate-900 text-slate-900" : "border-transparent text-slate-500 hover:text-slate-900 hover:border-slate-300"
                    ) %>
      <% end %>
    </nav>
  </div>

  <div id="services" class="min-w-full divide-y divide-gray-200 space-y-5">
    <% if @services.any? %>
      <% @services.each do |service| %>
        <div class="flex flex-col sm:flex-row justify-between items-center pb-5 sm:pb-0">
          <%= render service %>
          <div class="w-full sm:w-auto flex flex-col sm:flex-row space-x-2 space-y-2">
            <%= link_to "Show", [:superadmin, service], class: "w-full sm:w-auto text-center rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
            <%= link_to "Edit", edit_superadmin_service_path(service), class: "w-full sm:w-auto text-center rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
            <% if (public_post = service.taxbranch&.post).present? %>
              <%= link_to "Mostra", pricing_post_path(public_post), class: "w-full sm:w-auto text-center rounded-md px-3.5 py-2.5 bg-emerald-100 text-emerald-800 hover:bg-emerald-200 inline-block font-medium" %>
            <% end %>
            <%= button_to "Destroy", [:superadmin, service], method: :delete, class: "w-full sm:w-auto rounded-md px-3.5 py-2.5 text-white bg-red-600 hover:bg-red-500 font-medium cursor-pointer", data: { turbo_confirm: "Are you sure?" } %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p class="text-center my-10">No services found.</p>
    <% end %>
  </div>
</div>
