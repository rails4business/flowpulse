<% content_for :title, "Journeys" %>
<!-- app/views/superadmin/taxbranches/show.html.erb -->


<div class="w-full space-y-6">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 text-green-600 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
    <div>
      <h1 class="font-bold text-4xl text-slate-900">Journeys</h1>
      <p class="text-slate-500 text-sm mt-1">Gestisci percorsi e template della tua rete.</p>
    </div>
    <%= link_to "Nuovo journey",
          new_journey_path,
          class: "inline-flex items-center justify-center rounded-md px-4 py-2.5 bg-blue-600 hover:bg-blue-500 text-white font-medium" %>
  </div>

  <% current_filter = params[:filter].presence&.to_s %>
  <% filters = [
       { key: nil,                     label: "Tutti" },
       { key: "idea",                  label: "idea", badge: "bg-blue-50 text-blue-700" },
       { key: "task",                  label: "task", badge: "bg-amber-50 text-amber-800" },
       { key: "milestone",             label: "milestone", badge: "bg-emerald-50 text-emerald-800" },
       { key: "process",               label: "process", badge: "bg-slate-100 text-slate-700" },
       { key: "cycle_template",        label: "cycle_template", badge: "bg-violet-50 text-violet-800" },
       { key: "cycle_instance",        label: "cycle_instance", badge: "bg-teal-50 text-teal-800" },
       { key: "activity",              label: "activity", badge: "bg-orange-50 text-orange-800" }
     ] %>

  <div class="flex flex-wrap gap-2 text-xs">
    <% filters.each do |filter| %>
      <% active = (filter[:key].presence || "") == (current_filter || "") %>
      <% path =
           if filter[:key].present?
             journeys_path(filter: filter[:key])
           else
             journeys_path
           end %>
      <%= link_to filter[:label],
            path,
            class: [
              "px-3 py-1 rounded-full border transition",
              active ? "bg-slate-900 text-white border-slate-900" : (filter[:badge] || "bg-white text-slate-600 border-slate-200 hover:border-slate-400")
            ].join(" ") %>
    <% end %>
  </div>

  <% if @journeys.any? %>
    <table class="min-w-full divide-y divide-slate-200 text-sm bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wide text-slate-500">Titolo</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wide text-slate-500">Taxbranch</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wide text-slate-500">Tipo</th>
          <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wide text-slate-500">Avanzamento</th>
          <th class="px-4 py-2 text-right text-xs font-medium uppercase tracking-wide text-slate-500">Azioni</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% @journeys.each do |journey| %>
          <tr class="hover:bg-slate-50/60">
            <td class="px-4 py-3">
              <%= link_to journey.title.presence || "Senza titolo",
                    journey_path(journey),
                    class: "font-medium text-slate-900 hover:underline" %>
            </td>
            <td class="px-4 py-3 text-xs text-slate-600">
              <%= journey.taxbranch&.slug_label || journey.taxbranch&.name || "—" %>
            </td>
            <td class="px-4 py-3 text-xs">
              <% badge_class, badge_label =
                   if journey.idea?
                     ["bg-blue-50 text-blue-700", "idea"]
                   elsif journey.task?
                     ["bg-amber-50 text-amber-800", "task"]
                   elsif journey.milestone?
                     ["bg-emerald-50 text-emerald-800", "milestone"]
                   elsif journey.process?
                     ["bg-slate-100 text-slate-700", "process"]
                   elsif journey.cycle_template?
                     ["bg-violet-50 text-violet-800", "cycle_template"]
                   elsif journey.cycle_instance?
                     ["bg-teal-50 text-teal-800", "cycle_instance"]
                   elsif journey.activity?
                     ["bg-orange-50 text-orange-800", "activity"]
                   else
                     ["bg-slate-100 text-slate-700", "—"]
                   end %>
              <span class="inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold <%= badge_class %>">
                <%= badge_label %>
              </span>
            </td>
            <td class="px-4 py-3 text-xs text-slate-600">
              <div class="flex flex-col gap-0.5">
                <span class="font-medium text-slate-800"><%= journey.human_stage %></span>
                <span class="text-slate-500"><%= journey_date_label(journey) %></span>
              </div>
            </td>
            <td class="px-4 py-3 text-right text-xs">
              <div class="inline-flex gap-2">
                <%= link_to "Apri",
                      journey_path(journey),
                      class: "inline-flex items-center rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" %>
                <%= link_to "Modifica",
                      edit_journey_path(journey),
                      class: "inline-flex items-center rounded-md border border-slate-200 px-2 py-1 hover:bg-slate-50" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="rounded-xl border border-dashed border-slate-300 bg-white p-8 text-center text-sm text-slate-500">
      Nessun journey corrisponde al filtro selezionato.
      <%= link_to "Crea il primo percorso", new_journey_path, class: "text-blue-600 font-medium hover:underline ml-1" %>
    </div>
  <% end %>
</div>


  <!--div id="journeys" class="min-w-full divide-y divide-gray-200 space-y-5">
    <% if @journeys.any? %>
      <%# @journeys.each do |journey| %>
        <div class="flex flex-col sm:flex-row justify-between items-center pb-5 sm:pb-0">
          <%#= render journey %>
          <div class="w-full sm:w-auto flex flex-col sm:flex-row space-x-2 space-y-2">
            <%#= link_to "Show", journey, class: "w-full sm:w-auto text-center rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
            <%#= link_to "Edit", edit_journey_path(journey), class: "w-full sm:w-auto text-center rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
            <%#= button_to "Destroy", journey, method: :delete, class: "w-full sm:w-auto rounded-md px-3.5 py-2.5 text-white bg-red-600 hover:bg-red-500 font-medium cursor-pointer", data: { turbo_confirm: "Are you sure?" } %>
          </div>
        </div>
      <%# end %>
    <% else %>
      <p class="text-center my-10">No journeys found.</p>
    <% end %>
  </div-->
</div>
